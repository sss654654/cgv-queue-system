image:
  repository: "cgv-api"
  tag: "latest"
  pullPolicy: IfNotPresent

nameOverride: ""
fullnameOverride: ""

namespace: cgv-api

# ★★★ replicaCount 증가 ★★★
replicaCount: 4  # 1 -> 4로 변경

resources:
  requests:
    memory: "1Gi"      # 256Mi -> 1Gi
    cpu: "500m"        # 250m -> 500m
  limits:
    memory: "2Gi"      # 512Mi -> 2Gi
    cpu: "1500m"       # 500m -> 1500m

service:
  type: ClusterIP
  port: 80
  targetPort: 8080

ingress:
  enabled: true
  className: "alb"
  annotations:
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/healthcheck-path: /health
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'
    alb.ingress.kubernetes.io/ssl-redirect: '443'
    alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:ap-northeast-2:732739477448:certificate/5e20380b-b111-4517-8327-aa939583f448
    alb.ingress.kubernetes.io/load-balancer-attributes: idle_timeout.timeout_seconds=600
  host: "dev.api.peacemaker.kr"
  paths:
    - path: /
      pathType: Prefix

probes:
  startupProbe:
    enabled: true
    httpGet:
      path: "/health/ready"
      port: 8080
    initialDelaySeconds: 180
    periodSeconds: 5
    failureThreshold: 30
  livenessProbe:
    enabled: true
    httpGet:
      path: "/health/live"
      port: 8080
    periodSeconds: 10
    failureThreshold: 3
  readinessProbe:
    enabled: true
    httpGet:
      path: "/health/ready"
      port: 8080
    periodSeconds: 5
    failureThreshold: 3

config:
  # ★★★ 기존 설정 ★★★
  username: "admin"
  database: "cgv"
  writeUrl: "iamroot-cgv-db-cluster.cluster-cfucw40ewjht.ap-northeast-2.rds.amazonaws.com"
  writePort: "3306"
  readUrl: "iamroot-cgv-db-cluster.cluster-ro-cfucw40ewjht.ap-northeast-2.rds.amazonaws.com"
  readPort: "3306"
  redisHost: "cgv-redis-cluster-gfbhur.serverless.apn2.cache.amazonaws.com"
  redisPort: "6379"
  
  kinesisStreamName: "cgv-admissions-stream"
  useKinesis: "true"              # ★ 추가: Kinesis 사용 여부
  kinesisConsumerEnabled: "true"  # ★ 추가: Kinesis Consumer 활성화
  kinesisBatchSize: "10"          # ★ 추가: 배치 크기
  kinesisPollInterval: "1000"     # ★ 추가: 폴링 간격

  maxActiveSessions: "2"
  sessionTimeoutSeconds: "30"
  
  # ★★★ 새로 추가할 동적 스케일링 설정 ★★★
  baseSessionsPerPod: "2"           # Pod당 기본 세션 수
  maxTotalSessions: "50"            # 전체 최대 제한
  enableDynamicScaling: "true"      # 동적 스케일링 활성화
  fallbackPodCount: "4"             # K8s 연결 실패 시 Pod 수
  kubernetesNamespace: "cgv-api"    # 네임스페이스
  enableK8sDiscovery: "true"        # Pod Discovery 활성화

secret:
  password: "iamroot0816"

hpa:
  enabled: true
  minReplicas: 4        # 3 -> 4로 변경
  maxReplicas: 10
  targetCPUUtilizationPercentage: 60
  targetMemoryUtilizationPercentage: 60
  behavior:
    scaleUp:
      stabilizationWindowSeconds: 60
      percentPolicy: 100
      podsPolicy: 3
      periodSeconds: 10
    scaleDown:
      stabilizationWindowSeconds: 60
      percentPolicy: 20
      podsPolicy: 1
      periodSeconds: 30